from pymongo import MongoClient
import time

#connect to mongo and create connection to PIP database
client = MongoClient('mongodb+srv://cowen:compproject@cluster0.1qgln.mongodb.net/Cluster0?retryWrites=true&w=majority')
db = client.rooms
count = 0


iteration_count = 0
temp = [0, 0, 0, 0, 0, 0, 0]
humidity = [0, 0, 0, 0, 0, 0, 0]
light = [0, 0, 0, 0, 0, 0, 0]

while True:

    result = db.PIPdata.find_one()
    print(result)
    temp.pop(0)
    humidity.pop(0)
    light.pop(0)
    temp.append(result['Temperature'])
    humidity.append(result['Humidity'])
    light.append(result['Light'])
    print(temp)
    print(light)
    print(humidity)
    with open('chart_page.html', 'w') as f:
        f.write(
                """
                
    <canvas id="myChart"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>    
    var ctx = document.getElementById('myChart').getContext('2d');
    var chart = new Chart(ctx, {{
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {{
            labels: ['t1', 't2', 't3', 't4', 't5', 't6', 't7'],
            datasets: [{{
                label: 'Temperature',
                backgroundColor: 'rgb(236, 219, 83)',
                fill: false,
                borderColor: 'rgb(236, 219, 83)',
                data: [{tempOne}, {tempTwo}, {tempThree}, {tempFour}, {tempFive}, {tempSix}, {tempSeven}]
            }},
            {{
                label: 'Humidity',
                backgroundColor: 'rgb(227, 65, 50)',
                fill: false,
                borderColor: 'rgb(227, 65, 50)',
                data: [{humOne}, {humTwo}, {humThree}, {humFour}, {humFive}, {humSix}, {humSeven}]
            }},
            {{
                label: 'Light',
                backgroundColor: 'rgb(108, 60, 220)',
                fill: false,
                borderColor: 'rgb(108, 60, 220)',
                data: [{lightOne}, {lightTwo}, {lightThree}, {lightFour}, {lightFive}, {lightSix}, {lightSeven}]
            }}
            ]
        }},

        // Configuration options go here
        options: {{
            animation: {{
                duration: 0
            }}
        }}
    }});

    window.setTimeout(function () {{
    window.location.reload();
    }}, 3000);



    </script>
                """.format(tempOne=temp[0], tempTwo=temp[1], tempThree=temp[2], tempFour=temp[3], tempFive=temp[4], tempSix=temp[5], tempSeven=temp[6],
                           humOne=humidity[0], humTwo=humidity[1], humThree=humidity[2], humFour=humidity[3], humFive=humidity[4], humSix=humidity[5], humSeven=humidity[6],
                            lightOne=light[0], lightTwo=light[1], lightThree=light[2], lightFour=light[3], lightFive=light[4], lightSix=light[5], lightSeven=light[6])
            )

    f.close()

   

    time.sleep(2)
